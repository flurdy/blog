---
layout: post
title: Send email via SendGrid on Heroku using Play! 2.0 with Scala
date: '2012-05-23T02:09:00.000+01:00'
author: flurdy
tags:
- email
- playframework
- heroku
- scala
- code
- play
modified_time: '2012-06-06T12:27:27.444+01:00'
blogger_id: tag:blogger.com,1999:blog-4019909.post-6030687003925407990
blogger_orig_url: http://blog.flurdy.com/2012/05/send-email-via-sendgrid-on-heroku-using.html
---

If you have a <a href="http://www.playframework.org/">Play! framework 2.0</a> application that you want to send email from, here are a few tips.<br /><br />These tips assumes you deploy to <a href="http://www.heroku.com/">Heroku</a>, but other platforms should work&nbsp;similarly. The examples here are using <a href="http://www.scala-lang.org/">Scala</a>, but Java should work along similar lines. Finally the specifics are for the <a href="http://sendgrid.com/">SendGrid</a> <a href="https://addons.heroku.com/sendgrid">add-on</a> for Heroku, but other mail server providers should be fine. <br /><br /><br />First add the free option of the SendGrid add-on to your Heroku app by typing in:<br /><blockquote class="tr_bq"><code>heroku addons:add sendgrid:starter</code></blockquote><br />Then configure your Play! app to use the <a href="https://github.com/typesafehub/play-plugins/tree/master/mailer">mail plugin</a> provided by <a href="http://typesafe.com/">Typesafe</a>:<br /><br />Add to your dependencies in the <i>project/Build.scala</i>&nbsp;file: (all on one line)<br /><blockquote class="tr_bq"><code>"com.typesafe" %% "play-plugins-mailer" % "<i>2.0.2</i>"</code></blockquote>Then create and add these to a&nbsp;<i>conf/play.plugins</i> file:&nbsp;(all on one line)<br /><blockquote class="tr_bq"><code>1500:com.typesafe.plugin.CommonsMailerPlugin</code></blockquote><br />Next configure the mail server settings. You can either add these directly to your <i>conf/application.conf</i>&nbsp;file, but I prefer to share my <a href="https://github.com/flurdy">projects' source code</a>, so my production settings are set via <a href="https://devcenter.heroku.com/articles/config-vars">environment variables</a>&nbsp;so that my username/password are not&nbsp;publicly&nbsp;available.<br /><br />However for the plugin to run <i>smpt.host </i>&nbsp;must be present. Open <i>conf/application.conf</i>&nbsp;and add:<br /><blockquote class="tr_bq"><code>smtp.host=mock</code></blockquote><br />On Heroku I append the settings to the Heroku's propriatory <a href="https://devcenter.heroku.com/articles/procfile"><i>Procfile</i></a> file. I append these settings to the <i>Procfile&nbsp;</i>to use SendGrid's servers:&nbsp;(all on one line)<br /><blockquote class="tr_bq"><code>-Dsmtp.host=smtp.sendgrid.net -Dsmtp.port=587 -Dsmtp.ssl=yes&nbsp;-Dsmtp.user=$SENDGRID_USERNAME -Dsmtp.password=$SENDGRID_PASSWORD</code></blockquote>You may already have other settings in the <i>Procfile,</i>&nbsp;e.g. database URL, so be aware of the <a href="http://stackoverflow.com/questions/10676667/play-2-0-scala-heroku-instance-isnt-seeing-every-variable-in-the-procfile/10746180#10746180">255 char limit</a>, and use a custom properties file instead.<br /><blockquote class="tr_bq"><code><span style="font-size: x-small;">web: target/start -Dhttp.port=${PORT}&nbsp;</span></code><br /><span style="font-family: monospace; font-size: x-small;">-Dconfig.resource=heroku-prod.conf</span></blockquote><br />The SendGrid add-on should create the environment&nbsp;<span style="font-family: monospace;">SENDGRID_USERNAME</span> and <span style="font-family: monospace;">SENDGRID_PASSWORD</span>&nbsp;variables for you.<br />You can verify this with:  <br /><blockquote class="tr_bq"><code>heroku config</code></blockquote><br />Finally we then create our actual application code to send email:<br /><blockquote class="tr_bq"><span style="font-family: monospace; font-size: x-small;">package notifiers</span><br /><span style="font-family: monospace; font-size: x-small;">import com.typesafe.plugin._</span><br /><span style="font-family: monospace; font-size: x-small;">import play.api.Play.current</span><br /><span style="font-family: monospace; font-size: x-small;">import play.api.Play</span><br /><span style="font-family: monospace; font-size: x-small;">import play.Logger</span><br /><span style="font-family: monospace; font-size: x-small;">object EmailNotifier {</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; def sendMail</span><span style="font-family: monospace; font-size: x-small;">&nbsp;{</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; val mail = use[MailerPlugin].email</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; mail.setSubject("Mail test")</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; mail.addRecipient("Joe Smith &nbsp;&lt;joe@example.com&gt;","sue@example.com")</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; mail.addFrom("Jon Doe &lt;joe@example.com&gt;")</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; mail.send( "Test email" )</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; }</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; def sendTestMail {</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp;&nbsp;if(Play.current.mode == Mode.Prod){</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; Play.current.configuration.getString("smtp.host") match {</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; &nbsp; case None =&gt;&nbsp;</span><span style="font-family: monospace; font-size: x-small;">Logger.debug("Email mock")</span><span style="font-family: monospace; font-size: x-small;"><br class="Apple-interchange-newline" />&nbsp; &nbsp; &nbsp; &nbsp; case Some("mock") =&gt;&nbsp;</span><span style="font-family: monospace; font-size: x-small;">Logger.debug("Email mock")</span><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; case _ =&gt; sendMail(participant)</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; }</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; } else {</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; &nbsp; Logger.debug("Email mock")}</span><br /><span style="font-family: monospace; font-size: x-small;">&nbsp; }</span><br /><span style="font-family: monospace; font-size: x-small;">}</span></blockquote>(In case of this posts cant parse tags replace <i>&amp;lt;</i>&nbsp;<i>&nbsp;</i>and<i>&nbsp;&amp;gt;</i>&nbsp;with<i> </i>less than and greater than tags<i>;</i>)<br /><i><br /></i><br /><br /><br />This should be all that is needed.<br /><br /><br />Play! 1.x did have a handy mock email interface for development and testing. I will try and find a suitable replacement for 2.0 and update this post when I do.<br /><i><br /></i><br /><br /><br />For more information<br /><br /><ul><li>Play! 2.0:&nbsp;<a href="http://www.playframework.org/">http://www.playframework.org/</a></li><li>Play! 2.0 docs:&nbsp;<a href="https://github.com/playframework/Play20/wiki">https://github.com/playframework/Play20/wiki</a></li><li>Heroku and SendGrid:&nbsp;<a href="https://devcenter.heroku.com/articles/sendgrid">https://devcenter.heroku.com/articles/sendgrid</a></li><li>Mail plugin for Play! 2.0:&nbsp;<a href="https://github.com/typesafehub/play-plugins/tree/master/mailer">https://github.com/typesafehub/play-plugins/tree/master/mailer</a></li><li>Heroku environment variables:&nbsp;<a href="https://devcenter.heroku.com/articles/config-vars">https://devcenter.heroku.com/articles/config-vars</a></li></ul><br /><br /><br /><br />