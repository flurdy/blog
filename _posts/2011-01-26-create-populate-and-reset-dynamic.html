---
layout: post
title: Create, populate and reset a dynamic database (HSQLDB,Hibernate,SQLMaven,DbUnit)
date: '2011-01-26T09:48:00.004Z'
author: flurdy
tags:
- hsqldb
- code
- hibernate
- jetty
- sqlmaven
- maven
- sql
modified_time: '2011-01-26T12:15:15.046Z'
blogger_id: tag:blogger.com,1999:blog-4019909.post-2071201673987971223
blogger_orig_url: http://blog.flurdy.com/2011/01/create-populate-and-reset-dynamic.html
---

Thought I'd jot down how I create, populate and reset databases for development and testing. I use this method in my <a href="http://www.java.com/en/">Java</a> based pet projects such as <a href="http://code.flurdy.com/grid/snaps/">Snaps</a> <sup><a href="http://grid.flurdy.com/snaps">[app]</a><a href="https://github.com/flurdy/snaps">[code]</a></sup> and <a href="http://wishlist.sourceforge.net/">Wishlist</a> <sup><a href="http://grid.flurdy.com/wishlist">[app]</a><a href="http://wishlist.hg.sourceforge.net/hgweb/wishlist/">[code]</a></sup>. I also include this setup as default in my <a href="https://github.com/flurdy/WebAppTemplate">project template</a>.<br /><br />My projects are <a href="http://maven.apache.org/">Maven</a> based, using <a href="http://www.eclipse.org/jetty/">Jetty</a> as java container through its <a href="http://wiki.eclipse.org/Jetty/Feature/Jetty_Maven_Plugin">maven plugin</a>. In addition I also use <a href="http://www.zeroturnaround.com/jrebel/">JRebel</a>, <a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> and <a href="http://www.ubuntu.com/">Ubuntu</a>, a setup I described in <a href="http://flurdy.com/docs/intellij/">this howto: Ubuntu + IntelliJ + Maven + Jetty + JRebel</a>, but none of these are required.<br /><br />This setup is enables a fluid, <a href="http://brettporter.wordpress.com/2006/01/11/developing-with-jetty-where-have-you-been-all-my-life/">very dynamic and quick development</a> process. In addition I then use the in memory database <a href="http://hsqldb.org/">HSQLDB</a> for quick and standalone database interaction.<br /><br />Using <a href="http://en.wikipedia.org/wiki/Java_Persistence_API">JPA</a>/<a href="http://www.hibernate.org/">Hibernate</a> with hsqldb, my tables can be created automatically when I start Jetty. However in developement and testing I prefer to have some default data pre populated. <br /><br />This is where <a href="http://www.dbunit.org/">DbUnit</a> comes in to play. With DBunit's <a href="http://mojo.codehaus.org/dbunit-maven-plugin/">maven plugin</a> I can export my current data and populate future databases with the same data. As it is all easy to read XML I can edit manually the basic stub data as well. <br /><br />However DbUnit can not create the database as it is run before jetty:run action, so I use the <a href="http://mojo.codehaus.org/sql-maven-plugin/">SQL-Maven</a> plugin for this purpose. Again SQL Maven needs to know what tables to create, so I use the <a href="http://mojo.codehaus.org/maven-hibernate3/hibernate3-maven-plugin/">Maven Hibernate3 Plugin</a> to export a schema from the JPA annotations.<br /><br /><br />This combination allows me to: <ol><br /><li>Check out my project anywhere</li><br /><li>Create and populate the database with stub data with one command.</li><br /><li>Run the application via jetty</li><br /><li>Test the application straight away</li><br /><li>or develop dynamically with instant feedback</li><br /></ol><br /><br /><h3>How to set up Hibernate, SQLMaven and DbUnit plugins</h3><br /><br /><h4>Prerequisites/assumptions</h4><ul><li>Java</li><br /><li>Maven</li><br /><li>Jetty (can be <a href="http://tomcat.apache.org">tomcat</a> <a href="http://mojo.codehaus.org/tomcat-maven-plugin/">maven plugin</a>)</li><br /><li>JPA annotations</li><br /><li>HSQLDB (using file based hsqldb persistance to survive restarts)</li><br /></ul><br /><br /><h4>JPA annotations -> Schema: Hibernate</h4><br />To export the JPA annotations into a database schema we include the Maven Hibernate3 Plugin in your pom.xml. This is quite a long plugin section as it defines a few dependencies which otherwise may be overriden by the plugin and lead to problems <a href="http://blog.flurdy.com/2010/07/orghibernatemappingexception-could-not.html">like this mapping exception</a>.<br /><br /><code><br />&lt;profile&gt;<br />&nbsp;&nbsp;&lt;id&gt;hbm-export&lt;/id&gt;<br />&nbsp;&nbsp;&lt;build&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugins&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hibernate3-maven-plugin&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;2.2&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;executions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;execution&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;phase&gt;process-classes&lt;/phase&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;goals&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;goal&gt;hbm2ddl&lt;/goal&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/goals&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/execution&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/executions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;components&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;component&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;hbm2ddl&lt;/name&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;implementation&gt;jpaconfiguration&lt;/implementation&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/component&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/components&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;componentProperties&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;persistenceunit&gt;${project.artifactId}&lt;/persistenceunit&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;outputfilename&gt;schema.ddl&lt;/outputfilename&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;drop&gt;false&lt;/drop&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;create&gt;true&lt;/create&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;export&gt;false&lt;/export&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;format&gt;true&lt;/format&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/componentProperties&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependencies&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;hsqldb&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hsqldb&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${hsqldb.version}&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.hibernate&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${hibernate.version}&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;cglib&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;cglib&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;commons-logging&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.hibernate&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${hibernate.version}&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;cglib&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;cglib&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;commons-logging&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.hibernate&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hibernate-annotations&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${hibernate.version}&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;cglib&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;cglib&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;commons-logging&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;commons-logging&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusion&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/exclusions&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependencies&gt;                        <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugins&gt;<br />&nbsp;&nbsp;&lt;/build&gt;<br />&lt;/profile&gt;<br /></code><br /><br />To run the schema creation action on its own:<br /><br /><code>mvn -DskipTests&nbsp;\<br/><br /> -Dhibernate.dialect=org.hibernate.dialect.HSQLDialect&nbsp;\<br/><br />    -P hbm-export compile hibernate3:hbm2ddl;</code><br /><br />Note: We need to compile the JPA classes so that the plugin can extract annotation information from them.<br /><br />Note2: that Hibernate/Red Hat have a bad track record of including <a href="http://stackoverflow.com/questions/1230249/how-can-i-use-maven-to-get-the-latest-hibernate-release">their plugins and releases properly in maven central repository</a>, so you might either want to adjust your dependeinces and repositories accordingly. Or you can use <a href="http://code.flurdy.com/nexus/">my proxy repository</a>:<br /><br /><code><br />&lt;repositories&gt;<br />&nbsp;&nbsp;&lt;repository&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;id&gt;code-flurdy-repo&lt;/id&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;code@flurdy repository&lt;/name&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;url&gt;http://code.flurdy.com/nexus/content/groups/noncentral&lt;/url&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;releases&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/releases&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;<br />&nbsp;&nbsp;&lt;/repository&gt;<br />&lt;/repositories&gt;<br />&lt;pluginRepositories&gt;<br />&nbsp;&nbsp;&lt;pluginRepository&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;id&gt;code-flurdy-repo&lt;/id&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;code@flurdy repository&lt;/name&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;url&gt;http://code.flurdy.com/nexus/content/groups/noncentral&lt;/url&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;releases&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/releases&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;snapshots&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/snapshots&gt;<br />&nbsp;&nbsp;&lt;/pluginRepository&gt;<br />&lt;/pluginRepositories&gt;<br /></code><br /><br />Please if your project is popular do not use my repo as it will explode my <a href="http://aws.amazon.com">ec2/S3</a> data bandwidth usage!<br /><br /><br /><h4>Schema -> Database: SQLMaven</h4><br /><br />To create your database from this schema with SQL-Maven, add this to you pom.xml<br /><br /><code><br />&lt;profile&gt;<br />&nbsp;&nbsp;&lt;id&gt;sqlmaven&lt;/id&gt;<br />&nbsp;&nbsp;&lt;build&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugins&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;sql-maven-plugin&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;1.3&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependencies&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;hsqldb&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hsqldb&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${hsqldb.version}&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependencies&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;driver&gt;${db.driverClassName}&lt;/driver&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;url&gt;${db.url}&lt;/url&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;username&gt;${db.username}&lt;/username&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;${db.password}&lt;/password&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;autocommit&gt;true&lt;/autocommit&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;srcFiles&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;srcFile&gt;target/hibernate3/sql/schema.ddl&lt;/srcFile&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/srcFiles&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugins&gt;<br />&nbsp;&nbsp;&lt;/build&gt;<br />&lt;/profile&gt;<br /></code><br /><br />To run the database creation action on its own:<br /><br /><code>mvn -DskipTests -P sqlmaven sql:execute;</code><br /><br /><br /><h4>Database population: DbUnit</h4><br /><br />To populate your database via DbUnit, add this to you pom.xml<br /><br /><code><br />&lt;profile&gt;<br />&nbsp;&nbsp;&lt;id&gt;dbunit&lt;/id&gt;<br />&nbsp;&nbsp;&lt;build&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugins&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;dbunit-maven-plugin&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;1.0-beta-3&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependencies&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;hsqldb&lt;/groupId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hsqldb&lt;/artifactId&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${hsqldb.version}&lt;/version&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependency&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/dependencies&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dataTypeFactoryName&gt;org.dbunit.ext.hsqldb.HsqldbDataTypeFactory&lt;/dataTypeFactoryName&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;url&gt;jdbc:hsqldb:file:${project.basedir}/target/db/build;shutdown=true&lt;/url&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;driver&gt;org.hsqldb.jdbcDriver&lt;/driver&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;username&gt;sa&lt;/username&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;password&gt;&lt;/password&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;type&gt;CLEAN_INSERT&lt;/type&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;src&gt;src/test/data/stub.xml&lt;/src&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugins&gt;<br />&nbsp;&nbsp;&lt;/build&gt;<br />&lt;/profile&gt;<br /></code><br /><br />First you need data to export. I suggest you run jetty:run action and add/use the application to create data in the database. Eg.: Register a user, create default domain objects, or whatever your application uses.<br /><br />You then stop the application and export the data created:<br /><br /><code>mvn -DskipTests -P dbunit dbunit:export;</code><br /><br />These are by default exported to target/dbunit/export.xml.<br /><br />These are a good base data. You may try and adjust and extend this file if you like, but be aware that you might brake it, so prehaps try unadjusted initially.<br /><br />Copy the export file to test/data so that it can be part of your source control etc. You may have noticed I already included the test/data as a src element in the plugin.<br /><br /><code>cp target/dbunit/export.xml test/data/stub.xml;</code><br /><br />Run the database population action (remember to have a new clean database):<br /><br /><code>mvn -DskipTests -P dbunit dbunit:operation;</code><br /><br /><br />Example configuration of all these plugins can be found in this project's <a href="https://github.com/flurdy/WebAppTemplate/blob/master/pom.xml">pom.xml</a>.<br /><br /><br /><h4>Combined</h4><br /><br /><br />Above are the basic steps. These I then aggregate into a couple of common one liners:<br /><br /><b>Create database</b>:<br /><br /><code>mvn -o -DskipTests&nbsp;\<br/><br /> -Dhibernate.dialect=org.hibernate.dialect.HSQLDialect&nbsp;\<br/><br />    -P hbm-export,sqlmaven&nbsp;\<br/><br />    compile hibernate3:hbm2ddl sql:execute;</code><br /><br /><br/><br /><b>Create and populate database</b>:<br /><br /><code>mvn -o -DskipTests&nbsp;\<br/><br /> -Dhibernate.dialect=org.hibernate.dialect.HSQLDialect&nbsp;\<br/><br />    -P hbm-export,sqlmaven,dbunit&nbsp;\<br/><br />    compile hibernate3:hbm2ddl&nbsp;\<br/><br />    sql:execute dbunit:operation;</code><br /><br /><br/><br /><b>Reset database</b>:<br /><br /><code>rm -rf target/db;<br/><br />mvn -o -DskipTests&nbsp;\<br/><br /> -Dhibernate.dialect=org.hibernate.dialect.HSQLDialect&nbsp;\<br/><br />    -P hbm-export,sqlmaven,dbunit&nbsp;\<br/><br />    compile hibernate3:hbm2ddl&nbsp;\<br/><br />    sql:execute dbunit:operation;</code> <br /><br /><br/><br /><b>Clean, rebuild database and run jetty</b>:<br /><br /><code>mvn -o -DskipTests&nbsp;\<br/><br /> -Dhibernate.dialect=org.hibernate.dialect.HSQLDialect&nbsp;\<br/><br />    -P hbm-export,sqlmaven,dbunit&nbsp;\<br/><br />    clean compile hibernate3:hbm2ddl&nbsp;\<br/><br /> sql:execute dbunit:operation jetty:run;</code><br /><br />As you can see these one liners can be quite long so I again wrap these into bash scripts that I put in a <a href="https://github.com/flurdy/WebAppTemplate/tree/master/bin">bin folder</a>.<br /><br />You can extend this further to include these plugins as enabled by default and the maven goals as part of your other goals: E.g. include hbm:export and sqlmaven as part of install or test command or dbunit:operation with the jetty:run command, so that they are totally automatic. However I prefer a bit more control of when my data is reset etc.<br /><br /><br /><h3>Summary</h3><br /><br />With these plugins I can in one command create and populate my database, so that my app is up and running with data very quickly. Hope this is of use to others.<br /><br /><br/><br /><br/><br /><br/>